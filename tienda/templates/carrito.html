{% extends 'base.html' %}
{% load math_extras %}

{% block content %}
<div class="container mt-4">
    <h2>Mi Carrito</h2>

    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
    {% endif %}

    {% if carrito.items.count == 0 %}
        <div class="alert alert-info">Tu carrito está vacío.</div>
        <a href="{% url 'dashboard' %}" class="btn btn-primary">Seguir comprando</a>
    {% else %}
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Producto</th>
                        <th>Precio</th>
                        <th>Cantidad</th>
                        <th>Subtotal</th>
                        <th>Acción</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in items %}
                        <tr>
                            <td>{{ item.producto.nombre }}</td>
                            <td>S/ {{ item.producto.precio }}</td>
                            <td>{{ item.cantidad }}</td>
                            <td>S/ {{ item.cantidad|mul:item.producto.precio }}</td>
                            <td>
                                <form method="post" action="{% url 'quitar_del_carrito' item.id %}" style="display:inline;">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-sm btn-danger"
                                            onclick="return confirm('¿Seguro que deseas quitar este producto?')">
                                         Quitar
                                    </button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="3"><strong>Total:</strong></td>
                        <td><strong>S/ {{ carrito.total_precio|floatformat:2 }}</strong></td>
                        <td></td>
                    </tr>
                </tfoot>
            </table>
        </div>

        <div class="d-flex gap-2">
            <a href="{% url 'dashboard' %}" class="btn btn-outline-primary">Seguir comprando</a>
            <form method="post" action="{% url 'procesar_compra' %}" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-success"
                        onclick="return confirm('¿Confirmar compra?')">
                    Procesar Compra
                </button>
            </form>
        </div>
    {% endif %}
</div>
<style>
    .mt-4 {
        max-width: 1500px;
        margin: 20px auto 20px auto;
        font-size: 1.1rem; /* texto ligeramente más grande */
    }

    .mt-4 h2 {
        color: #00c0ff;
        font-size: 2rem; /* título más grande */
        margin-bottom: 12px;
        text-align: center;
    }
    td{
        display:table-cell;
        vertical-align: inherit;
        box-sizing: border-box;
        padding: 5px;
    }
    .table-striped {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: var(--border-radius);
    overflow: hidden;
    box-shadow: var(--shadow);
}
.d-flex.gap-2 {
    display: flex;
    justify-content: center;
    margin-top: 20px;
    gap: 50px; /* espacio entre botones */
    align-items: center;
    flex-wrap: wrap; /* que se mantengan responsivos en pantallas pequeñas */
}
.btn-outline-primary .btn-sm {
    background-color: #00c0ff;
    border-color: #00c0ff;
    color: white;
    border-radius: 8px;
    width: 200px;
    padding: 10px;
    cursor: pointer;
    transition: transform 0.2s;
    text-decoration: none;
}
.btn-sm{
    background-color: #00c0ff;
    border: #00c0ff;
    border-radius: 20px;
    color: white;
    padding: 10px;
    margin-top: 5px;

}

a {
    background-color: #00c0ff;
    border-color: #00c0ff;
    color: white;
    border-radius: 8px;
    width: 200px;
    padding: 10px;
    cursor: pointer;
    transition: transform 0.2s;
    text-decoration: none;
    text-align: center;
}


.btn-success {
    background-color: #00c0ff;
    border-color: #00c0ff;
    color: white;
    border-radius: 8px;
    width: 200px;
    padding: 15px;
    cursor: pointer;
    transition: transform 0.2s;
    text-decoration: none;
}
</style>    
{% endblock %}